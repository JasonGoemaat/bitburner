import { Player } from "../Player";
import { sanitizeExploits } from "./Exploit";

export function applyExploit(): void {
  if (Player.exploits && Player.exploits.length === 0) {
    return;
  }
  Player.exploits = sanitizeExploits(Player.exploits);
  const inc = Math.pow(1.001, Player.exploits.length);
  const dec = Math.pow(0.999, Player.exploits.length);

  Player.mults.hacking_chance *= inc;
  Player.mults.hacking_speed *= inc;
  Player.mults.hacking_money *= inc;
  Player.mults.hacking_grow *= inc;
  Player.mults.hacking *= inc;

  Player.mults.strength *= inc;
  Player.mults.defense *= inc;
  Player.mults.dexterity *= inc;
  Player.mults.agility *= inc;
  Player.mults.charisma *= inc;

  Player.mults.hacking_exp *= inc;
  Player.mults.strength_exp *= inc;
  Player.mults.defense_exp *= inc;
  Player.mults.dexterity_exp *= inc;
  Player.mults.agility_exp *= inc;
  Player.mults.charisma_exp *= inc;

  Player.mults.company_rep *= inc;
  Player.mults.faction_rep *= inc;

  Player.mults.crime_money *= inc;
  Player.mults.crime_success *= inc;

  Player.mults.hacknet_node_money *= inc;
  Player.mults.hacknet_node_purchase_cost *= dec;
  Player.mults.hacknet_node_ram_cost *= dec;
  Player.mults.hacknet_node_core_cost *= dec;
  Player.mults.hacknet_node_level_cost *= dec;

  Player.mults.work_money *= inc;
}

const my: any = (window as any).my || {};
(window as any).my = my;
Object.assign(my, {
  buffAllMults: (factor: number) => {
    if (factor <= 0.01 || factor > 1e6) {
      alert(`Invalid factor '${factor}'`);
      return;
    }
    Object.keys(my.Player.mults).forEach(key => {
      my.Player.mults[key] *= factor;
    })
  },
  buffAllExp: (amount: number) => {
    Object.keys(my.Player.exp).forEach(key => {
      // keys are ['agility', 'charisma', 'defense', 'dexterity', 'hacking', 'intelligence', 'strength']
      const toGainFunction = (statName: string) => `gain${statName.substring(0, 1).toUpperCase()}${statName.substring(1)}Exp`;
      (my.Player as any)[toGainFunction(key)](amount);
    })
  },
  cheat: () => {
    my.buffAllExp(1E9);
    my.Player.gainMoney(1e180);
  }
})
